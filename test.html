<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Random Falling Tiles</title>
<style>
    body {
        margin: 0;
        background: #111;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial, sans-serif;
        color: white;
        flex-direction: column;
    }

    #game {
        display: grid;
        grid-template-columns: repeat(12, 40px);
        grid-template-rows: repeat(12, 40px);
        gap: 2px;
    }

    .tile {
        width: 40px;
        height: 40px;
        background: #444;
        transition: background 0.3s, transform 0.4s, opacity 0.4s;
    }

    .player {
        background: #00ff88;
    }

    .warning {
        background: red !important;
    }

    .falling {
        transform: translateY(50px);
        opacity: 0;
    }

    #info {
        margin-bottom: 10px;
    }
</style>
</head>
<body>

<div id="info">Move with arrow keys. Survive.</div>
<div id="game"></div>

<script>
const SIZE = 12;
const WARNING_TIME = 1000;
const DROP_INTERVAL = 800;

const game = document.getElementById("game");

let grid = [];
let player = { x: 6, y: 6 };
let dropLoop;

function createGrid() {
    game.innerHTML = "";
    grid = [];
    for (let y = 0; y < SIZE; y++) {
        let row = [];
        for (let x = 0; x < SIZE; x++) {
            const tile = document.createElement("div");
            tile.classList.add("tile");
            game.appendChild(tile);
            row.push({ element: tile, exists: true, dropping: false });
        }
        grid.push(row);
    }
}

function drawPlayer() {
    document.querySelectorAll(".tile").forEach(t => t.classList.remove("player"));

    if (
        grid[player.y] &&
        grid[player.y][player.x] &&
        grid[player.y][player.x].exists
    ) {
        grid[player.y][player.x].element.classList.add("player");
    } else {
        resetGame();
    }
}

function getRandomExistingTile() {
    let existingTiles = [];

    for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
            if (grid[y][x].exists && !grid[y][x].dropping) {
                existingTiles.push({ x, y });
            }
        }
    }

    if (existingTiles.length === 0) return null;

    return existingTiles[Math.floor(Math.random() * existingTiles.length)];
}

function triggerRandomDrop() {
    const tilePos = getRandomExistingTile();
    if (!tilePos) return;

    const tile = grid[tilePos.y][tilePos.x];
    tile.dropping = true;
    tile.element.classList.add("warning");

    setTimeout(() => {
        tile.exists = false;
        tile.element.classList.remove("warning");
        tile.element.classList.add("falling");

        // If player is standing there â†’ death
        if (player.x === tilePos.x && player.y === tilePos.y) {
            resetGame();
        }
    }, WARNING_TIME);
}

function move(dx, dy) {
    player.x += dx;
    player.y += dy;

    if (
        player.x < 0 ||
        player.x >= SIZE ||
        player.y < 0 ||
        player.y >= SIZE ||
        !grid[player.y][player.x].exists
    ) {
        resetGame();
        return;
    }

    drawPlayer();
}

function resetGame() {
    clearInterval(dropLoop);
    player = { x: 6, y: 6 };
    createGrid();
    drawPlayer();
    dropLoop = setInterval(triggerRandomDrop, DROP_INTERVAL);
}

document.addEventListener("keydown", e => {
    switch (e.key) {
        case "ArrowUp": move(0, -1); break;
        case "ArrowDown": move(0, 1); break;
        case "ArrowLeft": move(-1, 0); break;
        case "ArrowRight": move(1, 0); break;
    }
});

resetGame();
</script>

</body>
</html>

